<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>Rectangle</title>
<link rev="made" href="mailto:" />
</head>

<body style="background-color: white">

<p><a name="__index__"></a></p>
<!-- INDEX BEGIN -->

<ul>

	<li><a href="#rectangle">Rectangle</a></li>
	<ul>

		<li><a href="#synopsis">Synopsis</a></li>
		<li><a href="#description">Description</a></li>
		<li><a href="#constructors">Constructors</a></li>
		<ul>

			<li><a href="#new">new</a></li>
			<li><a href="#rectangle">rectangle</a></li>
		</ul>

		<li><a href="#methods">Methods</a></li>
		<ul>

			<li><a href="#check">check</a></li>
			<li><a href="#is">is</a></li>
			<li><a href="#a,b,c">a,b,c</a></li>
			<li><a href="#clone">clone</a></li>
			<li><a href="#accuracy">accuracy</a></li>
			<li><a href="#intersection">intersection</a></li>
			<li><a href="#intersects">intersects</a></li>
			<li><a href="#visible">visible</a></li>
			<li><a href="#project">project</a></li>
			<li><a href="#projectinto">projectInto</a></li>
		</ul>

		<li><a href="#exports">Exports</a></li>
		<li><a href="#credits">Credits</a></li>
		<ul>

			<li><a href="#author">Author</a></li>
			<li><a href="#copyright">Copyright</a></li>
			<li><a href="#license">License</a></li>
		</ul>

	</ul>

</ul>
<!-- INDEX END -->

<hr />
<p>
</p>
<h1><a name="rectangle">Rectangle</a></h1>
<p>Rectangles in 3d space</p>
<p><a href="mailto:PhilipRBrenan@yahoo.com,">PhilipRBrenan@yahoo.com,</a> 2004, Perl License</p>
<p>
</p>
<h2><a name="synopsis">Synopsis</a></h2>
<p>Example t/rectangle.t</p>
<pre>
 #_ Rectangle __________________________________________________________
 # Test 3d rectangles          
 # philiprbrenan@yahoo.com, 2004, Perl License    
 #______________________________________________________________________
 
 use Math::Zap::Rectangle;
 use Math::Zap::Vector;
 use Test::Simple tests=&gt;3;
 
 my ($a, $b, $c, $d) =
  (vector(0,    0, +1),
   vector(0, -1.9, -1),
   vector(0, -2.0, -1),
   vector(0, -2.1, -1)
  );
 
 my $r = rectangle
  (vector(-1,-1, 0),
   vector( 2, 0, 0),
   vector( 0, 2, 0)
  );
 
 ok($r-&gt;intersects($a, $b) == 1);
 ok($r-&gt;intersects($a, $c) == 1);
 ok($r-&gt;intersects($a, $d) == 0);</pre>
<p>
</p>
<h2><a name="description">Description</a></h2>
<p>Rectangles in 3d space</p>
<pre>
 
 package Math::Zap::Rectangle;
 $VERSION=1.03;
 use Math::Zap::Vector check=&gt;'vectorCheck';
 use Math::Zap::Matrix new3v=&gt;'matrixNew3v';
 use Carp;</pre>
<p>
</p>
<h2><a name="constructors">Constructors</a></h2>
<p>
</p>
<h3><a name="new">new</a></h3>
<p>Create a rectangle from 3 vectors:</p>
<pre>
 a position of any corner
 b first side
 c second side.</pre>
<p>Note that vectors b,c must be at right angles to each other.</p>
<pre>
 
 sub new($$$)
  {my ($a, $b, $c) = vectorCheck(@_);
   $b-&gt;dot($c) == 0 or confess 'non rectangular rectangle specified';
   bless {a=&gt;$a, b=&gt;$b, c=&gt;$c}; 
  }</pre>
<p>
</p>
<h3><a name="rectangle">rectangle</a></h3>
<p>Create a rectangle from 3 vectors - synonym for <a href="#new">new</a>.</p>
<pre>
 
 sub rectangle($$$) {new($_[0],$_[1],$_[2])};</pre>
<p>
</p>
<h2><a name="methods">Methods</a></h2>
<p>
</p>
<h3><a name="check">check</a></h3>
<p>Check its a rectangle</p>
<pre>
 
 sub check(@)
  {for my $r(@_)
    {confess &quot;$r is not a rectangle&quot; unless ref($r) eq __PACKAGE__;
    }
   return (@_)
  }</pre>
<p>
</p>
<h3><a name="is">is</a></h3>
<p>Test its a rectangle</p>
<pre>
 
 sub is(@)
  {for my $r(@_)
    {return 0 unless ref($r) eq __PACKAGE__;
    }
   'rectangle';
  }</pre>
<p>
</p>
<h3><a name="a,b,c">a,b,c</a></h3>
<p>Components of rectangle</p>
<pre>
 
 sub a($) {my ($r) = check(@_); $r-&gt;{a}}
 sub b($) {my ($r) = check(@_); $r-&gt;{b}}
 sub c($) {my ($r) = check(@_); $r-&gt;{c}}</pre>
<p>
</p>
<h3><a name="clone">clone</a></h3>
<p>Create a rectangle from another rectangle</p>
<pre>
 
 sub clone($)
  {my ($r) = check(@_); # Rectangles
   bless {a=&gt;$r-&gt;a, b=&gt;$r-&gt;b, c=&gt;$r-&gt;c};
  }</pre>
<p>
</p>
<h3><a name="accuracy">accuracy</a></h3>
<p>Get/Set accuracy for comparisons</p>
<pre>
 
 my $accuracy = 1e-10;
 
 sub accuracy
  {return $accuracy unless scalar(@_);
   $accuracy = shift();
  }</pre>
<p>
</p>
<h3><a name="intersection">intersection</a></h3>
<p>Intersect line between two vectors with plane defined by a rectangle</p>
<pre>
 r rectangle
 a start vector
 b end vector</pre>
<p>Solve the simultaneous equations of the plane defined by the
rectangle and the line between the vectors:</p>
<pre>
   ra+l*rb+m*rc         = a+(b-a)*n 
 =&gt;ra+l*rb+m*rc+n*(a-b) = a-ra</pre>
<p>Note:  no checks (yet) for line parallel to plane.</p>
<pre>
 
 sub intersection($$$)
  {my ($r)     =       check(@_[0..0]); # Rectangles
   my ($a, $b) = vectorCheck(@_[1..2]); # Vectors
    
   $s = matrixNew3v($r-&gt;b, $r-&gt;c, $a-$b)/($a-$r-&gt;a);
  }</pre>
<p>
</p>
<h3><a name="intersects">intersects</a></h3>
<p># Test whether a line between two vectors intersects a rectangle
# Note:  no checks (yet) for line parallel to plane.</p>
<pre>
 
 sub intersects($$$)
  {my ($r)     =       check(@_[0..0]); # Rectangles
   my ($a, $b) = vectorCheck(@_[1..2]); # Vectors
    
   my $s = $r-&gt;intersection($a, $b);
   return 1 if $s-&gt;x &gt;=0 and $s-&gt;x &lt; 1 and
               $s-&gt;y &gt;=0 and $s-&gt;y &lt; 1 and
               $s-&gt;z &gt;=0 and $s-&gt;z &lt; 1;
   0;
  }</pre>
<p>
</p>
<h3><a name="visible">visible</a></h3>
<p># Visibility of a rectangle r hid by other rectangles R from a view
# point p.
# Rectangle r is divided up into I*J sub rectangles: each sub rectangle
# is tested for visibility from point p via the intervening rectangles.</p>
<pre>
 
 sub visible($$@)
  {my ($p)     = vectorCheck(@_[0.. 0]);    # Vector
   my ($I, $J) =            (@_[1.. 2]);    # Number of divisions  
   my ($r, @R) =       check(@_[3..scalar(@_)-1]);  # Rectangles
 
   my $v;
   $v-&gt;{r} = $r;                              # Save rectangle data
   $v-&gt;{I} = $I;                              # 
   $v-&gt;{J} = $J;                              #
 
   for      my $i(1..$I)                      # Along one edge
    {L: for my $j(1..$J)                      # Along the other edge
      {my $c = $r-&gt;a+($r-&gt;b)*(($i-1/2)/$I)    # Test point
                    +($r-&gt;c)*(($j-1/2)/$J);
       
       for my $R(@R)                          # Each intervening rectangle
        {my ($x, $y, $z) = ($c-&gt;x, $c-&gt;y, $c-&gt;z);
         my $in = $R-&gt;intersects($p, $c);
         next L if $in;                       # Solid, intersected
        }
       $v-&gt;{v}{$i}{$j} = 1;
      }
    }
   $v;
  }</pre>
<p>
</p>
<h3><a name="project">project</a></h3>
<p># Project rectangle r onto rectangle R from a point p</p>
<pre>
 
 sub project($$$)
  {my ($p)     = vectorCheck(@_[0.. 0]);    # Vector
   my ($r, $R) =            (@_[1.. 2]);    # Rectangles           
    
   my $A = $r-&gt;a;                             # Main  corner of r
   my $B = $r-&gt;a+$r-&gt;b;                       # One   corner of r
   my $C = $r-&gt;a+$r-&gt;c;                       # Other corner of r
 
   my $a = $R-&gt;intersection($p, $A);          # Main  corner of r on R
   my $b = $R-&gt;intersection($p, $B);          # One   corner of r on R
   my $c = $R-&gt;intersection($p, $C);          # Other corner of r on R
 
   $aR = $p+($A-$p)*$a-&gt;z;                    # Coordinates of main  corner of r on R
   $bR = $p+($B-$p)*$b-&gt;z;                    # Coordinates of one   corner of r on R
   $cR = $p+($C-$p)*$c-&gt;z;                    # Coordinates of other corner of r on R
   print &quot;a=$aR\n&quot;;
   print &quot;b=$bR\n&quot;;
   print &quot;c=$cR\n&quot;;
 
   rectangle($aR, $bR, $cR);
  }</pre>
<p>
</p>
<h3><a name="projectinto">projectInto</a></h3>
<p># Project rectangle r into rectangle R from a point p</p>
<pre>
 
 sub projectInto($$$)
  {my ($r, $R) =            (@_[0..1]);    # Rectangles           
   my ($p)     = vectorCheck(@_[2..2]);    # Vector
    
   my $A = $r-&gt;a;                             # Main     corner of r
   my $B = $r-&gt;a+$r-&gt;b;                       # One      corner of r
   my $C = $r-&gt;a+$r-&gt;c;                       # Other    corner of r
   my $D = $r-&gt;a+$r-&gt;b+$r-&gt;c;                 # Opposite corner of r
 
   my $a = $R-&gt;intersection($p, $A);          # Main     corner of r on R
   my $b = $R-&gt;intersection($p, $B);          # One      corner of r on R
   my $c = $R-&gt;intersection($p, $C);          # Other    corner of r on R
   my $d = $R-&gt;intersection($p, $D);          # Opposite corner of r on R
 
   ($a, $b, $d, $c);
  }</pre>
<p>
</p>
<h2><a name="exports">Exports</a></h2>
<p>Export <a href="#rectangle">rectangle</a></p>
<pre>
 
 use Math::Zap::Exports qw(
   rectangle ($$$)    
  );
 
 #_ Rectangle __________________________________________________________
 # Package loaded successfully
 #______________________________________________________________________
 
 1;</pre>
<p>
</p>
<h2><a name="credits">Credits</a></h2>
<p>
</p>
<h3><a name="author">Author</a></h3>
<p><a href="mailto:philiprbrenan@yahoo.com">philiprbrenan@yahoo.com</a></p>
<p>
</p>
<h3><a name="copyright">Copyright</a></h3>
<p><a href="mailto:philiprbrenan@yahoo.com,">philiprbrenan@yahoo.com,</a> 2004</p>
<p>
</p>
<h3><a name="license">License</a></h3>
<p>Perl License.</p>

</body>

</html>
